{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "University Support System Schema",
  "description": "JSON Schema definitions for 47 Doors university support entities",
  "version": "1.0",
  "definitions": {
    "Department": {
      "type": "string",
      "enum": [
        "financial_aid",
        "registration",
        "housing",
        "it_support",
        "academic_advising",
        "student_accounts",
        "general"
      ],
      "description": "University department identifiers"
    },
    "IntentCategory": {
      "type": "string",
      "enum": [
        "financial_aid",
        "registration",
        "housing",
        "it_support",
        "academic_advising",
        "student_accounts",
        "general"
      ],
      "description": "User intent classification categories"
    },
    "Priority": {
      "type": "string",
      "enum": ["low", "medium", "high", "urgent"],
      "description": "Ticket and request priority levels"
    },
    "TicketStatus": {
      "type": "string",
      "enum": ["open", "in_progress", "pending_user", "resolved", "closed", "escalated"],
      "description": "Support ticket status values"
    },
    "KnowledgeBaseArticle": {
      "type": "object",
      "required": ["article_id", "title", "content", "department", "category", "last_updated"],
      "properties": {
        "article_id": {
          "type": "string",
          "pattern": "^kb-[a-z_]+-[0-9]{3}$",
          "description": "Unique article ID in format kb-{dept}-{num}"
        },
        "title": {
          "type": "string",
          "maxLength": 100,
          "description": "Article headline"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Source URL for the article"
        },
        "content": {
          "type": "string",
          "minLength": 100,
          "maxLength": 3000,
          "description": "Full article text (200-500 words)"
        },
        "snippet": {
          "type": "string",
          "maxLength": 200,
          "description": "Brief preview text"
        },
        "department": {
          "$ref": "#/definitions/Department"
        },
        "category": {
          "type": "string",
          "description": "Sub-category within department"
        },
        "tags": {
          "type": "array",
          "items": {"type": "string"},
          "minItems": 3,
          "maxItems": 8,
          "description": "Search keywords"
        },
        "last_updated": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of last update"
        }
      }
    },
    "TestQuery": {
      "type": "object",
      "required": ["query_id", "query", "expected_intent", "difficulty", "is_ambiguous"],
      "properties": {
        "query_id": {
          "type": "string",
          "pattern": "^q-[0-9]{3}$",
          "description": "Unique query ID"
        },
        "query": {
          "type": "string",
          "description": "User query text"
        },
        "expected_intent": {
          "$ref": "#/definitions/IntentCategory"
        },
        "expected_department": {
          "$ref": "#/definitions/Department"
        },
        "difficulty": {
          "type": "string",
          "enum": ["easy", "medium", "hard"]
        },
        "is_ambiguous": {
          "type": "boolean",
          "description": "Whether query requires clarification"
        },
        "notes": {
          "type": "string",
          "description": "Explanation for edge cases"
        }
      }
    },
    "SupportTicket": {
      "type": "object",
      "required": ["ticket_id", "created_at", "department", "priority", "status", "subject"],
      "properties": {
        "ticket_id": {
          "type": "string",
          "pattern": "^TKT-[0-9]{6}$",
          "description": "Unique ticket identifier"
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time"
        },
        "department": {
          "$ref": "#/definitions/Department"
        },
        "priority": {
          "$ref": "#/definitions/Priority"
        },
        "status": {
          "$ref": "#/definitions/TicketStatus"
        },
        "subject": {
          "type": "string",
          "maxLength": 200
        },
        "description": {
          "type": "string"
        },
        "session_id": {
          "type": "string",
          "format": "uuid",
          "description": "Reference to conversation session"
        },
        "assigned_to": {
          "type": "string",
          "description": "Staff member email"
        },
        "resolution": {
          "type": "string",
          "description": "Resolution notes when closed"
        }
      }
    },
    "AgentDecision": {
      "type": "object",
      "required": ["timestamp", "session_id", "agent", "action", "decision", "confidence"],
      "properties": {
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "session_id": {
          "type": "string",
          "format": "uuid"
        },
        "agent": {
          "type": "string",
          "enum": ["QueryAgent", "RouterAgent", "ActionAgent"]
        },
        "action": {
          "type": "string",
          "enum": ["classify", "route", "execute", "escalate"]
        },
        "input": {
          "type": "string",
          "description": "User query or prior agent output"
        },
        "decision": {
          "type": "string",
          "description": "Selected category or action"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "reasoning": {
          "type": "string",
          "description": "Why this decision was made"
        }
      }
    },
    "ConversationSession": {
      "type": "object",
      "required": ["session_id", "started_at", "messages"],
      "properties": {
        "session_id": {
          "type": "string",
          "format": "uuid"
        },
        "started_at": {
          "type": "string",
          "format": "date-time"
        },
        "ended_at": {
          "type": "string",
          "format": "date-time"
        },
        "messages": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["role", "content", "timestamp"],
            "properties": {
              "role": {
                "type": "string",
                "enum": ["user", "assistant", "system"]
              },
              "content": {
                "type": "string"
              },
              "timestamp": {
                "type": "string",
                "format": "date-time"
              }
            }
          }
        },
        "context": {
          "type": "object",
          "properties": {
            "detected_intent": {"$ref": "#/definitions/IntentCategory"},
            "routed_department": {"$ref": "#/definitions/Department"},
            "ticket_id": {"type": "string"},
            "escalated": {"type": "boolean"}
          }
        }
      }
    }
  }
}
